import { Buffer } from 'node:buffer';
import { describe, expect, test } from 'vitest';
import { createTesseractCliExtractor, isTesseractCliAvailable } from './tesseract.usecases';

const imageBuffer = Buffer.from(
  // Lorem ipsum image in base64
  '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',
  'base64',
);

const isEnabled = await isTesseractCliAvailable();

describe('tesseract usecases', () => {
  describe.runIf(isEnabled)('createTesseractCliExtractor', () => {
    test('it extracts the text from an image buffer', async () => {
      const extract = createTesseractCliExtractor();

      const result = await extract(imageBuffer);

      expect(result).to.eql('Lorem ipsum dolor sit amet');
    });
  });
});
